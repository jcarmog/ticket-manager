<p-toast></p-toast>
<div class="min-h-screen flex flex-col bg-slate-50">
    <!-- Mobile Backdrop -->
    <div *ngIf="mobileSidebarOpen()" class="fixed inset-0 bg-black/50 z-[55] md:hidden transition-opacity"
        (click)="closeMobileSidebar()">
    </div>

    <!-- Navbar -->
    <nav class="bg-white border-b border-slate-200 px-6 py-3 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <button (click)="toggleSidebar()"
                class="p-2 rounded-lg hover:bg-slate-100 text-slate-600 mr-2 focus:outline-none">
                <i class="pi pi-bars text-xl"></i>
            </button>
            <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-bold">
                TM
            </div>
            <span class="font-semibold text-lg text-slate-800 hidden sm:block">{{ 'APP.NAME' | translate }}</span>
        </div>

        <div class="flex items-center gap-4" *ngIf="authService.currentUser() as user">
            <!-- Notification Bell -->
            <div class="relative cursor-pointer mr-2" (click)="op.toggle($event)">
                <i class="pi pi-bell text-xl text-slate-600 hover:text-indigo-600 transition-colors" pBadge
                    [value]="notifications().length.toString()" [severity]="'danger'"
                    *ngIf="notifications().length > 0"></i>
                <i class="pi pi-bell text-xl text-slate-600 hover:text-indigo-600 transition-colors"
                    *ngIf="notifications().length === 0"></i>
            </div>

            <p-overlayPanel #op [style]="{width: '350px'}">
                <ng-template pTemplate>
                    <div class="flex flex-col gap-3">
                        <h3 class="font-semibold text-slate-800 border-b pb-2">{{ 'NOTIFICATIONS.TITLE' | translate }}
                        </h3>
                        <div *ngIf="notifications().length === 0" class="text-slate-500 text-center py-4">
                            {{ 'NOTIFICATIONS.EMPTY' | translate }}
                        </div>
                        <div *ngFor="let notification of notifications()"
                            class="p-3 bg-slate-50 rounded-lg hover:bg-indigo-50 cursor-pointer transition-colors border border-slate-100"
                            (click)="markAsRead(notification)">
                            <p class="text-sm text-slate-800">{{ notification.message }}</p>
                            <span class="text-xs text-slate-500 mt-1 block">{{ notification.createdAt | date:'short'
                                }}</span>
                        </div>
                    </div>
                </ng-template>
            </p-overlayPanel>
            <div class="flex flex-col items-end">
                <span class="text-sm text-slate-600 hidden md:block">{{ user.name }}</span>
                <span *ngIf="user.teams && user.teams.length > 0" class="text-xs text-slate-500 hidden md:block"
                    [title]="getTeamNames(user)">
                    {{ getTeamNames(user) }}
                </span>
            </div>
            <div class="cursor-pointer hover:opacity-80 transition-opacity" (click)="navigateToProfile()">
                <p-avatar [image]="user.avatarUrl" [label]="!user.avatarUrl ? user.name.charAt(0) : undefined"
                    styleClass="bg-indigo-100 text-indigo-700 font-semibold" shape="circle">
                </p-avatar>
            </div>
            <p-button icon="pi pi-sign-out" [rounded]="true" [text]="true" severity="secondary"
                (onClick)="authService.logout()" [pTooltip]="'APP.LOGOUT' | translate">
            </p-button>
        </div>
    </nav>

    <div class="flex flex-1">
        <!-- Sidebar -->
        <aside
            class="bg-white border-r border-slate-200 fixed inset-y-0 left-0 z-[60] md:static transition-all duration-300 ease-in-out transform md:translate-x-0 w-64"
            [ngClass]="{
                '-translate-x-full': !mobileSidebarOpen(), 
                'translate-x-0': mobileSidebarOpen(),
                'md:w-20': sidebarCollapsed(),
                'md:w-64': !sidebarCollapsed()
            }">
            <div class="p-4">
                <ul class="space-y-1">
                    <li>
                        <a routerLink="/dashboard" routerLinkActive="bg-indigo-50 text-indigo-700"
                            class="flex items-center gap-3 px-3 py-2 text-slate-600 rounded-lg hover:bg-slate-50 transition-colors"
                            [ngClass]="{'justify-center': sidebarCollapsed()}"
                            [pTooltip]="sidebarCollapsed() ? ('MENU.DASHBOARD' | translate) : undefined"
                            tooltipPosition="right" (click)="closeMobileSidebar()">
                            <i class="pi pi-home text-xl"></i>
                            <span *ngIf="!sidebarCollapsed()" class="whitespace-nowrap">{{ 'MENU.DASHBOARD' | translate
                                }}</span>
                        </a>
                    </li>
                    <li>
                        <a routerLink="/tickets" routerLinkActive="bg-indigo-50 text-indigo-700"
                            class="flex items-center gap-3 px-3 py-2 text-slate-600 rounded-lg hover:bg-slate-50 transition-colors"
                            [ngClass]="{'justify-center': sidebarCollapsed()}"
                            [pTooltip]="sidebarCollapsed() ? ('MENU.TICKETS' | translate) : undefined"
                            tooltipPosition="right" (click)="closeMobileSidebar()">
                            <i class="pi pi-ticket text-xl"></i>
                            <span *ngIf="!sidebarCollapsed()" class="whitespace-nowrap">{{ 'MENU.TICKETS' | translate
                                }}</span>
                        </a>
                    </li>
                    <li *ngIf="authService.currentUser()?.role === 'ADMIN'">
                        <a routerLink="/teams" routerLinkActive="bg-indigo-50 text-indigo-700"
                            class="flex items-center gap-3 px-3 py-2 text-slate-600 rounded-lg hover:bg-slate-50 transition-colors"
                            [ngClass]="{'justify-center': sidebarCollapsed()}"
                            [pTooltip]="sidebarCollapsed() ? ('MENU.TEAMS' | translate) : undefined"
                            tooltipPosition="right" (click)="closeMobileSidebar()">
                            <i class="pi pi-users text-xl"></i>
                            <span *ngIf="!sidebarCollapsed()" class="whitespace-nowrap">{{ 'MENU.TEAMS' | translate
                                }}</span>
                        </a>
                        <a routerLink="/users" routerLinkActive="bg-indigo-50 text-indigo-700"
                            class="flex items-center gap-3 px-3 py-2 text-slate-600 rounded-lg hover:bg-slate-50 transition-colors"
                            [ngClass]="{'justify-center': sidebarCollapsed()}"
                            [pTooltip]="sidebarCollapsed() ? ('MENU.USERS' | translate) : undefined"
                            tooltipPosition="right" (click)="closeMobileSidebar()">
                            <i class="pi pi-user text-xl"></i>
                            <span *ngIf="!sidebarCollapsed()" class="whitespace-nowrap">{{ 'MENU.USERS' | translate
                                }}</span>
                        </a>
                    </li>
                </ul>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-4 md:p-6 overflow-auto">
            <router-outlet></router-outlet>
        </main>
    </div>
</div>